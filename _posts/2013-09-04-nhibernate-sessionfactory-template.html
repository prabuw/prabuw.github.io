---
layout: post
title: NHibernate SessionFactory Template
categories:
- NHibernate
tags:
- Mapping-By-Code
- NHibernate
- SessionFactory
status: publish
type: post
published: true
meta:
  _publicize_pending: '1'
author: 
---
<p>After having to come up with this boilerplate code over and over again, I have decided to write it up and put it on <a href="https://github.com/pwee167/NHibernateTemplate" target="_blank">GitHub</a>.Â  The code will allow you to build a Nhibernate Sessionfactory given a connection string to a database.</p>
<div class="wlWriterEditableSmartContent" id="scid:C89E2BDB-ADD3-4f7a-9810-1B7EACF446C1:d519ddb8-28c5-414b-b4ad-8a319a59e649" style="float:none;margin:0;display:inline;padding:0;">[sourcecode language="csharp" padlinenumbers="true" wraplines="true"]<br />
using System;<br />
using System.Data;<br />
using NHibernate;<br />
using NHibernate.Cfg;<br />
using NHibernate.Dialect;<br />
using NHibernate.Driver;<br />
using NHibernate.Mapping.ByCode;<br />
using System.Reflection;<br />
using System.Diagnostics.Contracts;</p>
<p>namespace NHibernateTemplate<br />
{<br />
    public class SessionFactoryFactory : ISessionFactoryFactory<br />
    {<br />
        private ISessionFactory _sessionFactory;<br />
        private readonly string _connectionString;</p>
<p>        public SessionFactoryFactory(string connectionString)<br />
        {<br />
            Contract.Assume(!String.IsNullOrEmpty(connectionString), &quot;Connection string cannot be null or empty.&quot;);<br />
            _connectionString = connectionString;<br />
        }</p>
<p>        private ISessionFactory BuildSessionFactory()<br />
        {<br />
            var mapper = new ModelMapper();<br />
            var configuration = new Configuration();</p>
<p>            mapper.AddMappings(Assembly.GetExecutingAssembly().GetExportedTypes());</p>
<p>            configuration.DataBaseIntegration(c =&gt;<br />
            {<br />
                c.ConnectionString = _connectionString;<br />
                c.IsolationLevel = IsolationLevel.ReadCommitted;<br />
                c.Driver();<br />
                c.Dialect();<br />
                c.BatchSize = 50;<br />
                c.Timeout = 30;</p>
<p>#if DEBUG<br />
                c.LogSqlInConsole = true;<br />
                c.LogFormattedSql = true;<br />
                c.AutoCommentSql = true;<br />
#endif<br />
            });</p>
<p>#if DEBUG<br />
            configuration.SessionFactory().GenerateStatistics();<br />
#endif</p>
<p>            configuration.AddMapping(mapper.CompileMappingForAllExplicitlyAddedEntities());<br />
            var sessionFactory = configuration.BuildSessionFactory();</p>
<p>            return sessionFactory;<br />
        }</p>
<p>        public ISessionFactory Instance<br />
        {<br />
            get<br />
            {<br />
                if (_sessionFactory == null)<br />
                {<br />
                    _sessionFactory = BuildSessionFactory();<br />
                }</p>
<p>                return _sessionFactory;<br />
            }<br />
        }<br />
    }<br />
}<br />
[/sourcecode]</p>
</div>
